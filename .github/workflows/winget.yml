name: WinGet

on:
  release:
    types: [released]

jobs:
  publish:
    name: Open WinGet PR
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check token
        id: token
        env:
          WINGET_TOKEN: ${{ secrets.WINGET_TOKEN }}
        run: python scripts/gha/common/check_env_output.py --env-var WINGET_TOKEN --missing-message "WINGET_TOKEN not set; skipping"

      - name: Publish to WinGet
        if: ${{ steps.token.outputs.present == 'true' }}
        uses: vedantmgoyal9/winget-releaser@main
        with:
          identifier: JKamsker.ZTNetCLI
          installers-regex: 'x86_64-pc-windows-msvc\\.zip$'
          token: ${{ secrets.WINGET_TOKEN }}
